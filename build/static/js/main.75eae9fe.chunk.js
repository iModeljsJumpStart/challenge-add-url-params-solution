(this["webpackJsonpbasic-viewport-app"]=this["webpackJsonpbasic-viewport-app"]||[]).push([[0],{1706:function(e,t,i){},1707:function(e,t,i){},1708:function(e,t,i){},1712:function(e,t,i){"use strict";i.r(t);var n=i(0),o=i(37),s=i(1),a=i(475),r=i(3),l=i(16),c=i(18),p=i(199);let d;!function(e){e[e.Local=0]="Local",e[e.GeneralPurpose=1]="GeneralPurpose"}(d||(d={}));class BasicViewportApp_BasicViewportApp{static get oidcClient(){return l.IModelApp.authorizationClient}static async startup(){await l.IModelApp.startup({applicationVersion:"1.0.0"}),await BasicViewportApp_BasicViewportApp.initializeOidc();const e=new Array;e.push(BasicViewportApp_BasicViewportApp.initializeRpc()),e.push(p.UiComponents.initialize(l.IModelApp.i18n)),await Promise.all(e)}static async initializeRpc(){let e=await this.getConnectionInfo();const t=function getSupportedRpcs(){return[r.IModelReadRpcInterface,r.IModelTileRpcInterface]}();e||(e={info:{title:"basic-viewport-app",version:"v1.0"},uriPrefix:"http://localhost:3001"}),r.BentleyCloudRpcManager.initializeClient(e,t)}static async initializeOidc(){const e={clientId:s.Config.App.getString("imjs_browser_test_client_id"),redirectUri:s.Config.App.getString("imjs_browser_test_redirect_uri"),scope:s.Config.App.getString("imjs_browser_test_scope"),responseType:"code"};await a.BrowserAuthorizationCallbackHandler.handleSigninCallback(e.redirectUri),l.IModelApp.authorizationClient=new a.BrowserAuthorizationClient(e);try{await BasicViewportApp_BasicViewportApp.oidcClient.signInSilent(new s.ClientRequestContext)}catch(t){}}static async getConnectionInfo(){const e=s.Config.App.getNumber("imjs_backend",d.Local);if(e===d.GeneralPurpose){const e=new c.UrlDiscoveryClient,t=new l.FrontendRequestContext;return{info:{title:"general-purpose-imodeljs-backend",version:"v2.0"},uriPrefix:await e.discoverUrl(t,"iModelJsOrchestrator.K8S",void 0)}}if(e!==d.Local)throw new Error('Invalid backend "'.concat(e,'" specified in configuration'))}}var w=i(320),u=(i(688),i(243)),m=i(7);i(1706),i(1707);const Toolbar_select=()=>{l.IModelApp.tools.run(l.SelectionTool.toolId)},fitView=()=>{l.IModelApp.tools.run(l.FitViewTool.toolId,l.IModelApp.viewManager.selectedView)},rotate=()=>{l.IModelApp.tools.run(l.RotateViewTool.toolId,l.IModelApp.viewManager.selectedView)},pan=()=>{l.IModelApp.tools.run(l.PanViewTool.toolId,l.IModelApp.viewManager.selectedView)},zoom=()=>{l.IModelApp.tools.run(l.ZoomViewTool.toolId,l.IModelApp.viewManager.selectedView)};var Toolbar=()=>n.createElement("div",{className:"toolbar"},n.createElement("a",{href:"#",title:l.SelectionTool.flyover,onClick:Toolbar_select},n.createElement("span",{className:"icon icon-cursor"})),n.createElement("a",{href:"#",title:l.FitViewTool.flyover,onClick:fitView},n.createElement("span",{className:"icon icon-fit-to-view"})),n.createElement("a",{href:"#",title:l.RotateViewTool.flyover,onClick:rotate},n.createElement("span",{className:"icon icon-gyroscope"})),n.createElement("a",{href:"#",title:l.PanViewTool.flyover,onClick:pan},n.createElement("span",{className:"icon icon-hand-2"})),n.createElement("a",{href:"#",title:l.ZoomViewTool.flyover,onClick:zoom},n.createElement("span",{className:"icon icon-zoom"})));class App_App extends n.Component{constructor(e,t){super(e,t),this._onStartSignin=async()=>{this.setState(e=>({user:{...e.user,isLoading:!0}})),BasicViewportApp_BasicViewportApp.oidcClient.signIn(new l.FrontendRequestContext)},this._onUserStateChanged=()=>{this.setState(e=>({user:{...e.user,isAuthorized:BasicViewportApp_BasicViewportApp.oidcClient.isAuthorized,isLoading:!1}}))},this._elementSelected=async e=>{if(1===e.set.elements.size){const t=Array.from(e.set.elements).pop();console.log("ID of selected element: "+t)}},this._onIModelSelected=async e=>{if(e)try{const t=await this.getFirstViewDefinitionId(e);e.selectionSet.onChanged.addListener(this._elementSelected),this.setState({imodel:e,viewDefinitionId:t})}catch(t){await e.close(),this.setState({imodel:void 0,viewDefinitionId:void 0}),alert(t.message)}else this.setState({imodel:void 0,viewDefinitionId:void 0})},this.state={user:{isAuthorized:BasicViewportApp_BasicViewportApp.oidcClient.isAuthorized,isLoading:!1}}}componentDidMount(){BasicViewportApp_BasicViewportApp.oidcClient.onUserStateChanged.addListener(this._onUserStateChanged)}componentWillUnmount(){BasicViewportApp_BasicViewportApp.oidcClient.onUserStateChanged.removeListener(this._onUserStateChanged)}async getFirstViewDefinitionId(e){const t=await e.views.queryDefaultViewId();if(s.Id64.isValid(t))return t;const i=await e.views.getViewList({from:l.SpatialViewState.classFullName});if(i.length>0)return i[0].id;const n=await e.views.getViewList({from:l.DrawingViewState.classFullName});if(n.length>0)return n[0].id;throw new Error("No valid view definitions in imodel")}get _signInRedirectUri(){const e=s.Config.App.get("imjs_browser_test_redirect_uri").split("://");return e[e.length-1]}render(){let e;return e=this.state.user.isLoading||window.location.href.includes(this._signInRedirectUri)?"signing-in...":this.state.user.isAuthorized?this.state.imodel&&this.state.viewDefinitionId?n.createElement(App_IModelComponents,{imodel:this.state.imodel,viewDefinitionId:this.state.viewDefinitionId}):n.createElement(App_OpenIModelButton,{onIModelSelected:this._onIModelSelected}):n.createElement(p.SignIn,{onSignIn:this._onStartSignin}),n.createElement("div",{className:"app"},e)}}class App_OpenIModelButton extends n.PureComponent{constructor(...e){super(...e),this.state={isLoading:!1},this._onClickOpen=async()=>{let e;this.setState({isLoading:!0});try{const t=await this.getIModelInfo();e=await l.RemoteBriefcaseConnection.open(t.projectId,t.imodelId,s.OpenMode.Readonly)}catch(t){alert(t.message)}await this.onIModelSelected(e)},this._onClickSignOut=async()=>{BasicViewportApp_BasicViewportApp.oidcClient&&BasicViewportApp_BasicViewportApp.oidcClient.signOut(new l.FrontendRequestContext)}}async getIModelInfo(){const e=s.Config.App.get("imjs_test_imodel"),t=s.Config.App.get("imjs_test_project",e),i=await l.AuthorizedFrontendRequestContext.create(),n=new w.ContextRegistryClient;let o;try{o=await n.getProject(i,{$filter:"Name+eq+'".concat(t,"'")})}catch(c){throw new Error('Project with name "'.concat(t,'" does not exist'))}const a=new u.IModelQuery;a.byName(e);const r=await l.IModelApp.iModelClient.iModels.get(i,o.wsgId,a);if(0===r.length)throw new Error('iModel with name "'.concat(e,'" does not exist in project "').concat(t,'"'));return{projectId:o.wsgId,imodelId:r[0].wsgId}}async onIModelSelected(e){this.props.onIModelSelected(e),this.setState({isLoading:!1})}render(){return n.createElement("div",null,n.createElement("div",null,n.createElement(m.Button,{size:m.ButtonSize.Large,buttonType:m.ButtonType.Primary,className:"button-open-imodel",onClick:this._onClickOpen},n.createElement("span",null,"Open iModel"),this.state.isLoading?n.createElement("span",{style:{marginLeft:"8px"}},n.createElement(m.Spinner,{size:m.SpinnerSize.Small})):void 0)),n.createElement("div",null,n.createElement(m.Button,{size:m.ButtonSize.Large,buttonType:m.ButtonType.Primary,className:"button-signout",onClick:this._onClickSignOut},n.createElement("span",null,"Sign Out"))))}}class App_IModelComponents extends n.PureComponent{render(){return n.createElement(n.Fragment,null,n.createElement(p.ViewportComponent,{style:{height:"100vh"},imodel:this.props.imodel,viewDefinitionId:this.props.viewDefinitionId}),n.createElement(Toolbar,null))}}i(1708);s.Logger.initializeToConsole(),s.Logger.setLevelDefault(s.LogLevel.Warning),s.Logger.setLevel("basic-viewport-app",s.LogLevel.Info),(async()=>{await BasicViewportApp_BasicViewportApp.startup(),o.render(n.createElement(App_App,null),document.getElementById("root"))})()},486:function(e,t){e.exports=require("electron")},831:function(e,t,i){e.exports=i(1712)},952:function(e,t){},954:function(e,t){}},[[831,1,2]]]);